@page "/produto/{Slug}"
@inherits DetailsPage

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="py-12">
    @if (IsLoading)
    {
        <div class="d-flex justify-center align-center" style="min-height: 50vh;">
            <MudProgressCircular Indeterminate="true" Size="Size.Large" Color="Color.Primary" />
        </div>
    }
    else if (Product is null)
    {
        <MudPaper Elevation="0" Class="pa-8 text-center rounded-xl border mud-border-warning" Style="background: var(--mud-palette-warning-hover);">
            <MudIcon Icon="@Icons.Material.Outlined.ErrorOutline" Color="Color.Warning" Size="Size.Large" Class="mb-4"/>
            <MudText Typo="Typo.h6" GutterBottom="true">Produto não encontrado</MudText>
            <MudText Class="mb-6">O item que você procura está indisponível no momento.</MudText>
            <MudButton Variant="Variant.Filled" 
                       Color="Color.Warning" 
                       OnClick="GoBack"
                       Size="Size.Large"
                       Class="rounded-lg px-8">
                Voltar para a loja
            </MudButton>
        </MudPaper>
    }
    else
    {
        <MudCard Elevation="4" Class="mx-auto rounded-xl overflow-hidden" Style="max-width: 1280px;">
            <MudGrid Spacing="0">
                
                @* --- COLUNA DA IMAGEM --- *@
                <MudItem xs="12" md="7" Class="d-flex align-center justify-center" 
                         Style="background-color: var(--mud-palette-surface); min-height: 600px;">
                        
                    <MudImage Src="@ImageUrl"
                              Alt="@Product.Title"
                              Fluid="true"
                              Class="pa-8"
                              Style="max-height: 550px; max-width: 100%; object-fit: contain;" />
                </MudItem>

                @* --- COLUNA DOS DETALHES E AÇÕES --- *@
                <MudItem xs="12" md="5" Class="pa-8 pa-md-12 d-flex flex-column bg-surface">
                    
                    @if (Product.Category?.Title is { Length: > 0 } categoryTitle)
                    {
                        <MudText Typo="Typo.overline" Color="Color.Primary" Class="mb-1" Style="font-weight: 700; letter-spacing: 1.5px;">
                            @categoryTitle
                        </MudText>
                    }

                    <MudText Typo="Typo.h4" Style="font-weight: 800; line-height: 1.3;">
                        @Product.Title
                    </MudText>
                    
                    <MudDivider Class="my-6" Light="true" />

                    <div>
                        <MudText Typo="Typo.h3" 
                                 Color="Color.Primary" 
                                 Class="mb-2" 
                                 Style="font-weight: 800;">
                            @Product.Price.ToString("C")
                        </MudText>
                        
                        <MudChip T="string" Color="Color.Success" Size="Size.Small" Variant="Variant.Text" Icon="@Icons.Material.Filled.CheckCircle" Class="ms-n1">
                            Em estoque
                        </MudChip>
                    </div>

                    <MudText Typo="Typo.body1" Class="mud-text-secondary my-6" Style="line-height: 1.8;">
                        @Product.Description
                    </MudText>
                        
                    <MudSpacer />
                        
                    <div class="d-flex gap-4 flex-column mt-8">
                        
                        <MudButton Variant="Variant.Filled"
                                   Color="Color.Primary" 
                                   Size="Size.Large"
                                   OnClick="OnAddToCartAsync"
                                   Disabled="@IsAddingToCart"
                                   StartIcon="@(IsAddingToCart ? null : Icons.Material.Filled.AddShoppingCart)"
                                   FullWidth="true"
                                   Class="py-4 rounded-lg elevation-3"
                                   Style="font-weight: 700; letter-spacing: 0.5px;">
                            @if (IsAddingToCart)
                            {
                                <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" Color="Color.Surface"/>
                                <MudText Class="ms-3">Processando...</MudText>
                            }
                            else
                            {
                                <MudText>Adicionar ao Carrinho</MudText>
                            }
                        </MudButton>

                        @* ✅ Botão Atualizado: Adicionado evento OnClick para OnBuyNow *@
                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Primary"
                                   Size="Size.Large"
                                   OnClick="OnBuyNow"
                                   StartIcon="@Icons.Material.Outlined.CreditCard"
                                   FullWidth="true"
                                   Class="py-3 rounded-lg"
                                   Style="border-width: 2px; font-weight: 600;">
                            Comprar Agora
                        </MudButton>
                    </div>
                </MudItem>
            </MudGrid>
        </MudCard>
    }
</MudContainer>